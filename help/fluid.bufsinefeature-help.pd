#N canvas 152 204 691 682 12;
#X obj 17 13 cnv 15 660 42 empty empty fluid.bufsinefeature 1 22 0 36 #4ba3fb #ffffff 0;
#X obj 509 60 fluid.referencelauncher fluid.bufsinefeature.html reference/sinefeature/;
#X obj 17 60 cnv 15 488 17 empty empty Buffer-Based\ Sinusoidal\ Peak\ Tracking 4 8 0 13 #e0e0e0 #404040 0;
#X obj 453 600 cnv 15 222 65 empty empty More\ information 4 10 0 13 #e0e0e0 #404040 0;
#X obj 464 642 note_on_multithreading;
#X obj 464 620 note_on_automatic_multiarrays;
#X obj 20 141 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X obj 47 260 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#N canvas 554 84 920 795 parameters 0;
#X obj 438 126 s \$0-params;
#X obj 439 380 s \$0-params;
#X obj 438 328 s \$0-params;
#X obj 438 226 s \$0-params;
#X obj 29 385 s \$0-params;
#X obj 438 276 s \$0-params;
#X msg 438 102 source arrayname;
#X msg 438 304 numchans -1;
#X msg 438 202 numframes -1;
#X msg 29 361 padding 1;
#X msg 438 252 startchan 0;
#X obj 438 176 s \$0-params;
#X msg 438 152 startframe 0;
#X text 580 195 How many frames to analyse, f 39;
#X text 171 354 controls the zero-padding added to either end of the source buffer or segment, f 34;
#X obj 441 745 s \$0-params;
#X obj 29 702 r \$0-params;
#X obj 29 725 outlet;
#X obj 29 125 s \$0-params;
#X text 192 158 for hopsize \, -1 = windowsize/2;
#X text 193 100 window size (1024) \, hop size (-1) \, fft size (-1), f 24;
#X text 192 199 for fftsize \, -1 = windowsize snapped to nearest power of 2, f 29;
#X obj 441 694 s \$0-params;
#X obj 29 283 s \$0-params;
#X obj 29 74 cnv 10 310 2 empty empty empty 20 12 0 14 #bbbbbb #404040 0;
#X text 27 54 FFT settings;
#X obj 28 531 cnv 10 233 2 empty empty empty 20 12 0 14 #bbbbbb #404040 0;
#X obj 435 74 cnv 10 200 2 empty empty empty 20 12 0 14 #bbbbbb #404040 0;
#X msg 29 102 fftsettings 1024 -1 1;
#X text 26 511 Warnings;
#X obj 29 610 s \$0-params;
#X msg 29 553 warnings 1;
#X msg 39 575 warnings 0;
#X text 118 552 warnings;
#X text 118 574 or no warnings;
#X msg 29 260 maxfftsize -1;
#X text 188 255 Set an explicit upper bound on the FFT size at object instantiation. The default of -1 sets this to whatever the initial FFT size is, f 25;
#X text 580 297 for a multichannel source \, how many channels to process, f 39;
#X text 580 245 for a multichannel source \, which channel should be processed first, f 39;
#X text 580 145 where in the source the analysis should start \, in samples, f 39;
#X text 28 6 Optional parameters to fluid.bufsinefeature;
#X msg 439 356 frequency arrayname;
#X obj 439 433 s \$0-params;
#X msg 439 409 magnitude arrayname;
#X obj 441 639 s \$0-params;
#X obj 441 587 s \$0-params;
#X obj 441 535 s \$0-params;
#X msg 441 511 order 1;
#X msg 441 615 maxnumpeaks 10;
#X msg 441 563 numpeaks 4;
#X text 554 608 destination Manually sets a maximum value for numpeaks. Can only be set at object instantiation., f 38;
#X text 582 402 The buffer where the interpolated magnitude of the peaks will be written., f 40;
#X text 584 352 The buffer where the interpolated frequency of the peaks will be written., f 39;
#X text 530 669 The units and scale used to report the frequency of the peaks. By default (0) \, it is in Hz (linear) \, and the alternative (1) is in MIDI (logarithmic)., f 51;
#X text 530 719 The units and scale used to report the magnitude of the peaks. By default (0) \, it is in amp (linear) \, and the alternative (1) is in dB (logarithmic)., f 51;
#X text 580 95 The array to use as the source material. The channels of multichannel buffers will be processed sequentially., f 40;
#X text 554 556 The number of peaks to search report back. It is capped at (fftSize / 2) + 1, f 42;
#X text 434 54 I/O;
#X text 554 504 How the reported peaks are to be ordered. By default (0) \, it is by frequencies \, and the alternative (1) is by magnitude., f 49;
#X obj 440 495 cnv 10 200 2 empty empty empty 20 12 0 14 #bbbbbb #404040 0;
#X text 439 475 Parameters;
#X msg 441 722 magunit 1;
#X msg 441 671 frequnit 1;
#X connect 6 0 0 0;
#X connect 7 0 2 0;
#X connect 8 0 3 0;
#X connect 9 0 4 0;
#X connect 10 0 5 0;
#X connect 12 0 11 0;
#X connect 16 0 17 0;
#X connect 28 0 18 0;
#X connect 31 0 30 0;
#X connect 32 0 30 0;
#X connect 35 0 23 0;
#X connect 41 0 1 0;
#X connect 43 0 42 0;
#X connect 47 0 46 0;
#X connect 48 0 44 0;
#X connect 49 0 45 0;
#X connect 61 0 15 0;
#X connect 62 0 22 0;
#X restore 569 394 pd parameters;
#N canvas 1043 -953 946 750 parameters 0;
#X floatatom 237 146 8 0 0 0 - - - 0;
#X floatatom 237 125 8 0 0 0 - - - 0;
#X floatatom 237 167 8 0 0 0 - - - 0;
#X obj 40 392 outlet;
#X floatatom 237 104 8 0 9 0 - - - 0;
#X obj 98 -120 loadbang;
#X obj 228 -4 r help.bufsinefeature.presets;
#X text 153 104 fftsettings;
#X text 104 125 detectionthreshold;
#X text 174 146 numpeaks;
#X text 174 166 frequnit;
#X text 181 186 magunit;
#X text 195 209 order;
#X obj 228 19 unpack 0 0 0 0 0 0;
#X msg 98 -92 \; help.bufsinefeature.presets 1024 -96 10 0 0 0;
#X msg 41 263 fftsettings \$1 -1 -1;
#X msg 139 287 detectionthreshold \$1;
#X msg 199 262 numpeaks \$1;
#X msg 185 315 frequnit \$1;
#X msg 185 340 magunit \$1;
#X msg 297 263 order \$1;
#X floatatom 237 188 8 0 0 0 - - - 0;
#X floatatom 237 209 8 0 0 0 - - - 0;
#X connect 0 0 17 0;
#X connect 1 0 16 0;
#X connect 2 0 18 0;
#X connect 4 0 15 0;
#X connect 5 0 14 0;
#X connect 6 0 13 0;
#X connect 13 0 4 0;
#X connect 13 1 1 0;
#X connect 13 2 0 0;
#X connect 13 3 2 0;
#X connect 13 4 21 0;
#X connect 13 5 22 0;
#X connect 15 0 3 0;
#X connect 16 0 3 0;
#X connect 17 0 3 0;
#X connect 18 0 3 0;
#X connect 19 0 3 0;
#X connect 20 0 3 0;
#X connect 21 0 19 0;
#X connect 22 0 20 0;
#X coords 0 -1 1 1 200 130 2 100 100;
#X restore 140 284 pd parameters;
#X obj 22 261 bng 15 250 50 0 empty empty empty 17 7 0 10 #c6ffc7 #000000 #000000;
#X text 556 373 more parameters;
#X obj 57 599 array get;
#X obj 139 599 array get;
#X obj 20 160 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 20 208 dac~;
#X obj 20 184 tabplay~ help.sinefeature.src;
#X msg 117 568 symbol help.sinefeature.freqs-\$1;
#X floatatom 170 523 5 0 0 0 - - - 0;
#X msg 352 567 symbol help.sinefeature.mags-\$1;
#X text 17 79 Interpolated Sinusoidal Peak Tracking on the Spectrum of Audio Stored in a Buffer.;
#N canvas 68 97 450 300 threesines 0;
#X obj 37 233 array set help.sinefeature.src;
#X obj 35 88 until;
#X obj 35 112 f;
#X obj 35 136 t f f f;
#X obj 84 110 + 1;
#X msg 84 74 0;
#X msg 35 64 44100;
#X obj 37 191 expr (sin($f1 * 440.) * 0.01) + (sin($f1 * 789.) * 0.03) + (sin($f1 * 535.) * 0.02);
#X obj 146 110 / 44100;
#X obj 35 168 * 1;
#X msg 146 86 6.28319;
#X text 136 29 generates a 3 sine chord;
#X obj 35 16 loadbang;
#X obj 35 40 t b b;
#X obj 35 266 array define help.sinefeature.src 44100;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 9 0;
#X connect 3 1 0 1;
#X connect 3 2 4 0;
#X connect 4 0 2 1;
#X connect 5 0 2 1;
#X connect 6 0 1 0;
#X connect 7 0 0 0;
#X connect 8 0 9 1;
#X connect 9 0 7 0;
#X connect 10 0 8 0;
#X connect 12 0 13 0;
#X connect 13 0 6 0;
#X connect 13 1 10 0;
#X restore 580 145 pd threesines;
#X text 21 141 1) Play the sound source \, a chord of 3 sines;
#X text 48 260 2) Trigger the analysis;
#X text 345 294 Same arguments as fluid.bufsines peak detection algorithm, f 19;
#X floatatom 57 523 5 0 0 0 - - - 0;
#X obj 496 167 clone 10 fluid.multiarray help.sinefeature.freqs, f 25;
#X obj 496 202 clone 10 fluid.multiarray help.sinefeature.mags, f 25;
#X floatatom 57 623 8 0 0 0 - - - 0;
#X floatatom 139 623 8 0 0 0 - - - 0;
#X text 18 643 peak frequency / magnitude;
#X text 95 525 frame;
#X text 211 522 'channel': which peak;
#X obj 56 498 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 57 498 3) Query a frame for a peak frequency and magnitude;
#N canvas 152 189 448 129 explanation 0;
#X text 13 9 With the default window size of 1024 \, there are only 2 peaks... this is because the distance between 2 peaks has to be clearly segregated in the FFT world. At the default 1024 and the usual SR of 44100 \, this is 43Hz per bin \, so 440 and 535 are too near each other... if we reprocess with a higher frame size \, we get the right values. Run with the fftsetting to 2048: volil√†!;
#X restore 242 626 pd explanation;
#X obj 22 426 fluid.bufsinefeature -source help.sinefeature.src -frequency help.sinefeature.freqs -magnitude help.sinefeature.mags -maxfftsize 2048, f 50;
#X obj 22 478 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 34 301 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X connect 9 0 36 0;
#X connect 10 0 36 0;
#X connect 10 0 38 0;
#X connect 12 0 28 0;
#X connect 13 0 29 0;
#X connect 14 0 16 0;
#X connect 16 0 15 0;
#X connect 16 0 15 1;
#X connect 17 0 12 2;
#X connect 18 0 17 0;
#X connect 18 0 19 0;
#X connect 19 0 13 2;
#X connect 25 0 12 0;
#X connect 25 0 13 0;
#X connect 36 0 37 0;
